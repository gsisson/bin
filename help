#!/usr/bin/env bash

cd ~/usr/

reset='\033[0m'
bold_green='\033[1;32m'
bold_cyan='\033[1;96m'
color="${bold_cyan}"

tmpf=$HOME/_notes.help.filenames.txt
rm -f ${tmpf}
trap "rm -f ${tmpf}" INT TERM EXIT

prog="$(basename $0)"
case $prog in
  notes)
    dir="usr/notes"
    prefix=''
    ;;
  help)
    dir="usr/bin"
    prefix='help.'
    ;;
  *)
    echo "unexpected option \"$prog\"!"
    exit 1
    ;;
esac

cd "$HOME/$dir"

if [ -f "${1}" ];then
  case $prog in
    notes)
      # SHOW it
      less ./"${1}"
      ;;
    help)
      # RUN it
      if [ ! -x ./"${1}" ]; then
        echo ./"${1}" is not executable
        exit 1
      fi
      eval ./"${1}"
      ;;
  esac
  exit $?
fi

# list files that match the glob (even it just one file matches)

if [ $(ack -i "${1}" ${prefix}* | wc -l) != 0 ]; then
  ack -i "${1}" ${prefix}*
fi

find . -type f | grep "${prefix}" > ${tmpf}

echo -e "${color}======================================${reset}"
if [ $(ack -i "${1}" ${tmpf} | wc -l) = 0 ]; then
  echo "no match for \"$1\" in any filename in ${dir}."
  exit
fi

ack -i "${1}" ${tmpf}
